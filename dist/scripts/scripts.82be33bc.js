"use strict";angular.module("shhhhApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","chart.js"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("shhhhApp").controller("MainCtrl",["$window","$scope","$interval","SoundMeter","AudioData",function(a,b,c,d,e){function f(a){e.record(a.instant,b.limit.value)}function g(a){window.stream=a,d.connectToSource(a),c(function(){f(d)},200)}function h(a){console.log("$window.navigator.getUserMedia error: ",a)}b.labels=e.labels,b.series=["Top Volume"],b.data=e.dataReference,b.slowMeter=e.lastData,b.showTopThreeAlert=!1,b.isNoiseOverLimit=e.isNoiseOverLimit,b.options=[{label:"3%",value:3},{label:"5%",value:5},{label:"10%",value:10},{label:"20%",value:20},{label:"30%",value:30},{label:"40%",value:40},{label:"50%",value:50},{label:"60%",value:60},{label:"70%",value:70},{label:"80%",value:80},{label:"90%",value:90},{label:"100%",value:100}],b.limit=b.options[0],b.$on("top-record",function(){b.showTopThreeAlert=!0,a.setTimeout(function(){b.showTopThreeAlert=!1},2e3)}),b.getTotal=function(){return 100},b.getData=function(){return 100*e.lastData};var i=window.constraints={audio:!0,video:!1};a.navigator.getUserMedia=a.navigator.getUserMedia||a.navigator.webkitGetUserMedia||a.navigator.mozGetUserMedia,a.navigator.getUserMedia(i,g,h)}]),angular.module("shhhhApp").controller("AboutCtrl",function(){}),angular.module("shhhhApp").service("SoundMeter",["AudioContext",function(a){this.context=a,this.instant=0,this.slow=0,this.clip=0,this.script=this.context.createScriptProcessor(2048,1,1);var b=this;this.script.onaudioprocess=function(a){var c,d=a.inputBuffer.getChannelData(0),e=0,f=0;for(c=0;c<d.length;++c)e+=d[c]*d[c],Math.abs(d[c])>.99&&(f+=1);b.instant=Math.sqrt(e/d.length),b.slow=.95*b.slow+.05*b.instant,b.clip=f/d.length},this.connectToSource=function(a){console.log("SoundMeter connecting"),this.mic=this.context.createMediaStreamSource(a),this.mic.connect(this.script),this.script.connect(this.context.destination)},this.stop=function(){this.mic.disconnect(),this.script.disconnect()}}]),angular.module("shhhhApp").service("AudioContext",["$window",function(a){try{return new a.webkitAudioContext}catch(b){console.error("Web Audio API not supported.")}}]),angular.module("shhhhApp").service("AudioData",["$rootScope",function(a){function b(){for(var a=[],b=0;c>b;b++)a.push(b+1);return a}var c=3,d=1e3;this.dataReference=[[0,0,0]],this.data=this.dataReference[0],this.lastData=0,this.limit=100;var e,f=this,g=!1,h=0;this.getLastDataInHundreds=function(){return 100*f.lastData},this.isNoiseOverLimit=function(){return f.getLastDataInHundreds()>=f.limit},this.record=function(b,c){function i(){return(new Date).getTime()-e>d}f.lastData=b,f.limit=c,g&&(h+=b);var j=f.isNoiseOverLimit();j&&!g&&(e=(new Date).getTime(),g=!0),!j&&g&&(g=!1,h>f.data[0]&&i()&&(f.data.shift(),f.data.push(h),f.data.sort(),a.$broadcast("top-record")),h=0)},this.labels=b()}]);