"use strict";angular.module("shhhhApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","chart.js"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("shhhhApp").controller("MainCtrl",["$scope","$interval",function(a,b){function c(){a.slowMeter=soundMeter.slow,g&&(h+=a.slowMeter),a.isNoiseOverLimit()&&!g&&(g=!0),!a.isNoiseOverLimit()&&g&&(g=!1,h>a.data[0][0]&&(a.data[0].shift(),a.data[0].push(h),a.data[0].sort(),a.showTopThreeAlert=!0,window.setTimeout(function(){a.showTopThreeAlert=!1},2e3)),h=0)}function d(a){this.context=a,this.instant=0,this.slow=0,this.clip=0,this.script=a.createScriptProcessor(2048,1,1);var b=this;this.script.onaudioprocess=function(a){var c,d=a.inputBuffer.getChannelData(0),e=0,f=0;for(c=0;c<d.length;++c)e+=d[c]*d[c],Math.abs(d[c])>.99&&(f+=1);b.instant=Math.sqrt(e/d.length),b.slow=.95*b.slow+.05*b.instant,b.clip=f/d.length}}function e(a){window.stream=a;var e=window.soundMeter=new d(window.audioContext);e.connectToSource(a),b(function(){c(e.slow)},200)}function f(a){console.log("navigator.getUserMedia error: ",a)}var g=!1,h=0;a.labels=["Third","Second","First"],a.series=["Series A"],a.data=[[0,0,0]],a.showTopThreeAlert=!1,a.onClick=function(a,b){console.log(a,b)},a.options=[{label:"3%",value:3},{label:"5%",value:5},{label:"10%",value:10},{label:"20%",value:20},{label:"30%",value:30},{label:"40%",value:40},{label:"50%",value:50},{label:"60%",value:60},{label:"70%",value:70},{label:"80%",value:80},{label:"90%",value:90},{label:"100%",value:100}],a.isNoiseOverLimit=function(){return a.getData()>=a.limit.value},a.slowMeter=0,a.limit=a.options[0],a.getTotal=function(){return 100},a.getData=function(){return 100*a.slowMeter},d.prototype.connectToSource=function(a){console.log("SoundMeter connecting"),this.mic=this.context.createMediaStreamSource(a),this.mic.connect(this.script),this.script.connect(this.context.destination)},d.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,window.audioContext=new AudioContext}catch(i){alert("Web Audio API not supported.")}var j=window.constraints={audio:!0,video:!1};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia(j,e,f)}]),angular.module("shhhhApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);